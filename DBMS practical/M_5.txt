-- Ensure database exists and use it
CREATE DATABASE IF NOT EXISTS employeedb;
USE employeedb;

-- Drop tables in correct dependency order (child tables first)
DROP TABLE IF EXISTS manages;
DROP TABLE IF EXISTS works;
DROP TABLE IF EXISTS company;
DROP TABLE IF EXISTS employee;

-- Create the employee table
CREATE TABLE employee (
    emp_id INT PRIMARY KEY,
    employee_name VARCHAR(50) UNIQUE,  -- UNIQUE so other tables can reference it
    street VARCHAR(50),
    city VARCHAR(50)
);

-- Create the company table
CREATE TABLE company (
    company_name VARCHAR(50) PRIMARY KEY,
    city VARCHAR(50),
    asset INT
);

-- Create the works table (link between employee and company)
CREATE TABLE works (
    employee_name VARCHAR(50),
    company_name VARCHAR(50),
    salary INT,
    FOREIGN KEY (employee_name) REFERENCES employee(employee_name),
    FOREIGN KEY (company_name) REFERENCES company(company_name)
);

-- Create the manages table
CREATE TABLE manages (
    employee_name VARCHAR(50),
    manager_name VARCHAR(50),
    FOREIGN KEY (employee_name) REFERENCES employee(employee_name)
);

-- Insert employee records
INSERT INTO employee (emp_id, employee_name, street, city) VALUES
(1, 'Amit', 'Mg Road', 'Pune'),
(2, 'Pooja', 'Camp', 'Pune'),
(3, 'Rohit', 'Karve Nagar', 'Mumbai'),
(4, 'Priya', 'Aundh', 'Bangalore'),
(5, 'Nikita', 'Deccan', 'Pune');

-- Insert company records
INSERT INTO company (company_name, city, asset) VALUES
('Tcs', 'Pune', 8000000),
('Infosys', 'Bangalore', 7000000),
('Techm', 'Mumbai', 6000000);

-- Insert works records
INSERT INTO works (employee_name, company_name, salary) VALUES
('Amit', 'Tcs', 12000),
('Pooja', 'Infosys', 15000),
('Rohit', 'Techm', 18000),
('Priya', 'Techm', 11000),
('Nikita', 'Infosys', 13000);

-- Insert manages records
INSERT INTO manages (employee_name, manager_name) VALUES
('Amit', 'Rohit'),
('Pooja', 'Priya'),
('Rohit', 'Nikita'),
('Priya', 'Amit'),
('Nikita', 'Pooja');

--  Verify that everything was created and inserted properly
SELECT * FROM employee;
SELECT * FROM company;
SELECT * FROM works;
SELECT * FROM manages;

-- 1. Employees working for 'Tcs'
SELECT employee_name FROM works WHERE company_name = 'Tcs';

-- 2. Employees and companies sorted
SELECT employee_name, company_name
FROM works
ORDER BY company_name ASC, employee_name DESC;

-- 3. Update city for employees working with Infosys
UPDATE employee
SET city = 'Bangalore'
WHERE employee_name IN (
  SELECT employee_name FROM works WHERE company_name = 'Infosys'
);

-- 4. Employees who work for Techm and earn more than 10000
SELECT e.employee_name, e.street, e.city
FROM employee e
JOIN works w ON e.employee_name = w.employee_name
WHERE w.company_name = 'Techm' AND w.salary > 10000;
