CREATE TABLE Borrower (
    Roll_no      NUMBER(5),
    Name         VARCHAR2(50),
    DateOfIssue  DATE,
    NameOfBook   VARCHAR2(100),
    Status       CHAR(1)      -- 'I' for Issued, 'R' for Returned
);

CREATE TABLE Fine (
    Roll_no NUMBER(5),
    Date_   DATE,
    Amt     NUMBER(10,2)
);

INSERT INTO Borrower VALUES (101, 'Ravi', TO_DATE('2024-10-10','YYYY-MM-DD'), 'DBMS Concepts', 'I');
INSERT INTO Borrower VALUES (102, 'Maya', TO_DATE('2024-10-20','YYYY-MM-DD'), 'Java Basics', 'I');
INSERT INTO Borrower VALUES (103, 'Gopal', TO_DATE('2024-09-25','YYYY-MM-DD'), 'Operating Systems', 'I');
COMMIT;

DECLARE
    v_rollno     Borrower.Roll_no%TYPE;
    v_bookname   Borrower.NameOfBook%TYPE;
    v_dateissue  Borrower.DateOfIssue%TYPE;
    v_days       NUMBER;
    v_fine       NUMBER := 0;
BEGIN
    -- Accept input from user
    v_rollno := &Roll_no;
    v_bookname := '&Book_Name';

    -- Get Date of Issue
    SELECT DateOfIssue INTO v_dateissue
    FROM Borrower
    WHERE Roll_no = v_rollno
      AND NameOfBook = v_bookname
      AND Status = 'I';

    -- Calculate number of days
    v_days := TRUNC(SYSDATE - v_dateissue);

    -- Calculate fine
    IF v_days > 15 AND v_days <= 30 THEN
        v_fine := (v_days - 15) * 5;
    ELSIF v_days > 30 THEN
        v_fine := (15 * 5) + ((v_days - 30) * 50);
    ELSE
        v_fine := 0;
    END IF;

    -- Update book status
    UPDATE Borrower
    SET Status = 'R'
    WHERE Roll_no = v_rollno
      AND NameOfBook = v_bookname;

    -- Insert fine if applicable
    IF v_fine > 0 THEN
        INSERT INTO Fine (Roll_no, Date_, Amt)
        VALUES (v_rollno, SYSDATE, v_fine);
    END IF;

    COMMIT;

    DBMS_OUTPUT.PUT_LINE('Borrower Roll No: ' || v_rollno);
    DBMS_OUTPUT.PUT_LINE('Book Name: ' || v_bookname);
    DBMS_OUTPUT.PUT_LINE('Total Days: ' || v_days);
    DBMS_OUTPUT.PUT_LINE('Fine Amount: Rs. ' || v_fine);
    DBMS_OUTPUT.PUT_LINE('Book return processed successfully.');

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('No record found for the given Roll No and Book Name.');
END;
/
