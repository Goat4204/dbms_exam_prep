CREATE TABLE Branch (
    branch_name VARCHAR(50) PRIMARY KEY,
    branch_city VARCHAR(50) NOT NULL,
    assets DECIMAL(15,2)
);

CREATE TABLE Account (
    acc_no INT PRIMARY KEY,
    branch_name VARCHAR(50),
    balance DECIMAL(10,2) CHECK(balance >= 0),
    FOREIGN KEY (branch_name) REFERENCES Branch(branch_name)
);

CREATE TABLE Customer (
    cust_name VARCHAR(50) PRIMARY KEY,
    cust_street VARCHAR(100),
    cust_city VARCHAR(50)
);

CREATE TABLE Depositor (
    cust_name VARCHAR(50),
    acc_no INT,
    FOREIGN KEY (cust_name) REFERENCES Customer(cust_name),
    FOREIGN KEY (acc_no) REFERENCES Account(acc_no)
);

CREATE TABLE Loan (
    loan_no INT PRIMARY KEY,
    branch_name VARCHAR(50),
    amount DECIMAL(10,2) CHECK(amount >= 0),
    FOREIGN KEY (branch_name) REFERENCES Branch(branch_name)
);

CREATE TABLE Borrower (
    cust_name VARCHAR(50),
    loan_no INT,
    FOREIGN KEY (cust_name) REFERENCES Customer(cust_name),
    FOREIGN KEY (loan_no) REFERENCES Loan(loan_no)
);

INSERT INTO Branch VALUES
('Pune_Station', 'Pune', 500000),
('Camp', 'Pune', 400000),
('Deccan', 'Pune', 300000);

INSERT INTO Account VALUES
(101, 'Pune_Station', 20000),
(102, 'Camp', 15000),
(103, 'Deccan', 10000);

INSERT INTO Customer VALUES
('Rahul', 'MG Road', 'Pune'),
('Priya', 'JM Road', 'Mumbai'),
('Amit', 'FC Road', 'Pune'),
('Neha', 'Shivaji Nagar', 'Pune');

INSERT INTO Depositor VALUES
('Rahul', 101),
('Priya', 102),
('Amit', 103);

INSERT INTO Loan VALUES
(201, 'Pune_Station', 50000),
(202, 'Camp', 20000),
(203, 'Deccan', 25000);

INSERT INTO Borrower VALUES
('Rahul', 201),
('Neha', 203);

CREATE VIEW View1 AS
SELECT DISTINCT c.cust_name
FROM Customer c
JOIN Borrower b ON c.cust_name = b.cust_name
JOIN Loan l ON b.loan_no = l.loan_no
WHERE l.branch_name = 'Pune_Station'
ORDER BY c.cust_name ASC;

-- To view data:
SELECT * FROM View1;

CREATE VIEW View2 AS
SELECT branch_name, branch_city FROM Branch;

-- Insert
INSERT INTO View2 VALUES ('Hadapsar', 'Pune');

-- Update
UPDATE View2 SET branch_city = 'Mumbai' WHERE branch_name = 'Camp';

-- Delete
DELETE FROM View2 WHERE branch_name = 'Deccan';

-- Check data
SELECT * FROM View2;

CREATE VIEW View3 AS
SELECT b.cust_name AS borrower_name, d.acc_no AS depositor_account
FROM Borrower b
JOIN Depositor d ON b.cust_name = d.cust_name;

-- Insert
INSERT INTO View3 VALUES ('Neha', 103);

-- Update (depends on DBMS support for updatable view)
UPDATE View3 SET depositor_account = 102 WHERE borrower_name = 'Rahul';

-- Delete
DELETE FROM View3 WHERE borrower_name = 'Neha';

-- Check
SELECT * FROM View3;

SELECT c.cust_name, a.acc_no, l.loan_no
FROM Customer c
LEFT JOIN Depositor d ON c.cust_name = d.cust_name
LEFT JOIN Account a ON d.acc_no = a.acc_no
LEFT JOIN Borrower b ON c.cust_name = b.cust_name
LEFT JOIN Loan l ON b.loan_no = l.loan_no

UNION

SELECT c.cust_name, a.acc_no, l.loan_no
FROM Customer c
RIGHT JOIN Depositor d ON c.cust_name = d.cust_name
RIGHT JOIN Account a ON d.acc_no = a.acc_no
RIGHT JOIN Borrower b ON c.cust_name = b.cust_name
RIGHT JOIN Loan l ON b.loan_no = l.loan_no;

-- Simple Index on branch_name
CREATE INDEX idx_branch ON Branch(branch_name);

-- Unique Index on cust_name
CREATE UNIQUE INDEX idx_customer ON Customer(cust_name);

SHOW INDEX FROM Customer;
SHOW INDEX FROM Branch;